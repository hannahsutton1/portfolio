name: Build PDF from README
 
on:
  push:
    branches: [ main ]
    paths:
      - "README.md"
      - ".github/workflows/md-to-pdf.yml"
  workflow_dispatch:
 
# ðŸ‘‡ Give the GITHUB_TOKEN write access so it can push commits
permissions:
  contents: write
 
jobs:
  build:
    runs-on: ubuntu-latest
    env:
      SOURCE_MD: README.md
      OUTPUT_PDF: downloads/readme.pdf
 
    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          persist-credentials: true
          fetch-depth: 0
 
      - name: Install Pandoc + XeLaTeX
        run: |
          sudo apt-get update
          sudo apt-get install -y pandoc texlive-latex-recommended texlive-xetex texlive-fonts-recommended
 
      - name: Prepare source without web-only blocks
        run: |
          awk 'BEGIN{drop=0} /<!-- PDF-EXCLUDE-START -->/{drop=1; next} /<!-- PDF-EXCLUDE-END -->/{drop=0; next} !drop{print}' "$SOURCE_MD" > /tmp/source.md
          echo "Prepared /tmp/source.md"
 
      - name: Convert Markdown â†’ PDF
        run: |
          mkdir -p "$(dirname "$OUTPUT_PDF")"
          pandoc /tmp/source.md -o "$OUTPUT_PDF" --pdf-engine=xelatex
 
      - name: Commit PDF back to repo
        uses: stefanzweifel/git-auto-commit-action@v5
        with:
          commit_message: "build(pdf): README â†’ downloads/readme.pdf"
          branch: main
          file_pattern: ${{ env.OUTPUT_PDF }}
